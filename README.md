## **系统功能说明文档**

### **一、 项目概述与部署方式**

本系统是一个集**题库管理、在线练习/考试、教学资源、数据分析、AI辅助**于一体的综合性教学平台。支持多角色（管理员、教师、学生）协同使用。

系统提供两种部署方式，以满足不同场景需求：

| 特性             | **线上体验版**                                               | **本地部署版**                                               |
| :--------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **访问方式**     | 直接访问公网服务器                                           | 需在本地或内网服务器自行部署                                 |
| **功能完整性**   | **功能与数据齐全**                                           | 删除了大部分用户数据，**核心题库与功能保留**，可自主二次开发 |
| **AI功能**       | 功能完整，可直接使用                                         | 默认**删除了API Key**，需在配置文件中填入自己的Key并**重启生效** |
| **性能与稳定性** | 相对稳定，但**服务器带宽较小**，高并发时响应慢               | 性能取决于本地服务器配置，内网无带宽瓶颈，适合集中使用       |
| **数据隐私**     | 数据存储于云端                                               | 数据完全自主可控，隐私性高                                   |
| **适用场景**     | 功能体验、演示、轻度使用                                     | **实际教学、内网考试、数据敏感**场景                         |
| **安全性**       | ▲**！！！**个人开发，屎山代码，安全性极差，不建议录入敏感数据▲ | 相对私密，安全性高                                           |
---

### **二、 核心功能模块详解

#### **1. 首页**

*   **公告栏**：管理员可编辑，支持Markdown语法。
*   **推荐阅读**：管理员可编辑，支持Markdown与外部超链接，用于分享学习资料或拓展内容。
*   **个人博客**：用户可发布简单的个人博客文章。

#### **2. 学习与资源中心**

*   **学习中心**：提供Python教程，以markdown形式呈现知识点（管理员可编辑现有内容）。
*   **论坛功能**（已隐藏，可通过/forum访问）：支持用户发帖与回复（基于开源Flask-BBS项目改造）。

#### **3. 题库管理系统（核心）**

*   **题目全生命周期管理**：
    *   **增**：支持单题添加、**批量导入**、**AI解析整卷添加**（综合题精度待提升）。
    *   **删改**：管理员可删改；
    *   **查**：支持高级筛选**（题型、知识点、难度、题号、正确率排序等），并支持精确/模糊查找切换。
*   **辅助功能**：
    *   **题型识别**：题目设有题型字段（0其他/1选择/2材料/3综合），支持手动设置或根据答案自动识别。
    *   **重复检测**：添加题目时自动判重（基于预存的解析HTML进行比对，允许合理偏差）。
    *   **AI生成解析**：支持调用**DeepSeek、ChatGPT系列、百度文心一言**等模型，根据题目和答案自动生成HTML格式解析。
*   **题目编辑器与导出**：
    *   使用Summernote富文本编辑器，支持图文混排、格式调整。
    *   **支持导出为Word文档**（通过前端JS将HTML转换，图片以Base64嵌入）。
    *   提供“清除格式”功能，整理HTML代码。
*   **知识点与标签**：
    *   知识点以**标签形式**进行选择和管理，支持**拖拽操作**。
    *   组卷时可通过标签预览和筛选题目。

#### **4. 练习与考试系统**

*   **模式智能识别**：练习标题包含“考试”或“测试”关键词时，自动进入**考试模式**（仅能参加一次，退出后时间不重置）；否则为**练习模式**（可反复进行）。
*   **试卷管理**：
    *   **组卷**：可从题库中选题，设定题目总量与每次抽取数量，实现**每人题目随机**，防止作弊。
    *   **试卷列表**：展示已做次数和最高分。
*   **做题与体验**：
    *   做题时有**10%概率触发加油动画**（彩蛋）。
    *   支持**字体大小调整**。
*   **成绩与统计分析**：
    *   **学生端**：可查看自己的历史做题结果和详细解析。
    *   **教师/管理员端**：
        *   **试卷统计**：可按班级、学生维度分析数据。
        *   **错题追踪**：支持查看做错某题的所有学生名单，并可**按错误选项进行分类查看**。
        *   **查看详情**：支持根据ID查看特定学生的完整做题情况。

#### **5. 用户与权限**

*   **角色体系**：分为**管理员(admin)、教师(teacher)、学生(student)**。
*   **权限控制**：
    *   普通用户无法看到管理员专属功能链接。
    *   后台文件已按角色分离，确保安全。
*   **用户功能**：
    *   支持**单个添加**与**批量导入**用户。
    *   用户可**修改密码、邮箱（头像自动用QQ头像）、设置昵称**。
    *   管理员拥有完整的**用户管理功能**。
*   **班级管理**：支持创建和管理班级，关联学生用户。

#### **6. AI与工具集成**

*   **派森小助手**：**DeepSeek V3**大模型，提供AI问答交互，支持连续对话。
*   **代码运行可视化工具**：
    *   支持对**字符串、列表、字典**等数据结构的运行过程进行监测和可视化。
    *   需要用户事先在配置中填写要监测的变量，可模仿模板中的格式。
*   **工具箱**：分类收集并链接各类实用网站。
*   **文件上传（云盘）**：简单的文件上传与共享空间，所有账户共享，暂不支持个人独立空间和删除功能。
*   **签到功能**：学生可进行每日签到。
*   **媒体播放**（测试功能）：支持视频同步播放，具备播放控制（上一首、下一首、循环模式）。

#### **7. 后台与系统维护**

*   **配置文件**：前端可修改后台配置文件（如IP白名单、GPT API信息等），修改后需重启生效。
*   **数据库维护**：支持删除冗余数据、自动备份（每日）、数据库同步迁移。
*   **性能优化**：
    *   将在线引用的JS/CSS替换为本地引用以加速访问。
    *   优化了数据库查询，解决N+1问题导致的响应缓慢。
    *   对题目列表、试卷统计等页面进行了分页和布局优化。
*   **BUG修复记录**：持续修复了包括试卷统计题目乱序、字体大小重置、数据删除关联错误、图表更新不及时等关键问题。

---

### **三、 技术要点与备注**

1.  **题型定义**：`0`：其他（自动识别）、`1`：选择题、`2`：材料题、`3`：综合题。
2.  **AI解析提示词**：固定以“【解析(GPT)】\n”开头，要求返回带HTML标签的格式，可临时修改。
3.  **Word导出依赖**：使用了第三方JS库进行前端转换，基本能符合需求，有少量不常见的样式可能会出错。
4.  **数据安全**：线上版仅供体验，重要数据建议使用本地部署版。
5.  **环境部署**：本地部署需安装数十个Python模块，可反复运行主程序根据错误提示安装。


# **二次开发**
项目也是一点一点扩展出来，比较杂乱，总体来说分为：
- 配置文件(config.py、config.json)：写了一些基本的网站配置，不够也有一些配置写在了其他地方，需要仔细查找。
- 启动文件(main.py)：项目入口。
- 数据库模型(models.py)：基于flask_migrate进行维护。整个就是一坨，基本不想动，二开建议只增别改，增加问题不大，改了几乎必挂。主要问题是许多表的关联在最初设计时没有加上查询、级联删除的优化，导致表与表之间的关联处理没有做好，但是增加列或者表一般问题不大。
- 数据库(questions.db)：sqlite数据库，单文件比较方便，如果要维护可以直接用软件打开，免去迁移。
- 业务逻辑(control.py)：虽说是业务但是也放了一些页面逻辑，但是主要的功能全部在这里面，可以找到对应的路由进行修改。
- 用户模块(user.py)：包含了用户的各类操作，增删改查记录登录登出等。
- 工具模块(utils.py)：包含了一些诸如加密、AI的函数
- 视图模块(pages.py)：虽说是视图，但也包含了一些功能，和业务逻辑模块有一定程度的重合，但大体能够分离。
- 前端(templates)：基于header.html模板，样式比较丑，可以统一优化。涉及管理员的部分放在admin中，有个base.html模板是搬的开源的论坛，全站模板文件是header.html。其他几个文件夹是曾经打算做模块化分离后来不了了之的烂尾工程。
- 上传文件(uploads)：放上传的文件、图片之类的。
- 静态文件(static)：所有的静态文件和样式、js之类的。

其他的文件和文件夹基本都是开发到一半的烂尾工程，如果删除了可能会导致一些小问题比如删除SparkApi.py可能导致模块丢失，不过只需到对应路由中删除导入的语句即可，不影响主要功能。
